.ORIG x3000
;初始化
LD R1 A
LD R2 B
LD R3 C
AND R4 R4 #0
ADD R4 R4 #1;R4是玩家回合指针，正为player1回合，负为player2回合

DISPLAY ADD R1 R1 #0
BRp TAG
ADD R2 R2 #0
BRp TAG
ADD R3 R3 #0
BRp TAG
BRz OVER

TAG LEA R0 ROWA
TRAP X22
ADD R5 R1 #0
JSR PRINT
LEA R0 ROWB
TRAP X22
ADD R5 R2 #0
JSR PRINT
LEA R0 ROWC
TRAP X22
ADD R5 R3 #0
JSR PRINT

ADD R4 R4 #0
BRp P1
BRn P2

P1 LEA R0 player1
TRAP x22
LEA R0 CHOOSE
TRAP x22
TRAP x20
TRAP x21
ST R0 ROW
TRAP x20
TRAP x21
ST R0 NUM
LD R0 NEWLINE
TRAP x21
LD R6 ROW
BRnzp NEXT

P2 LEA R0 player2
TRAP x22
LEA R0 CHOOSE
TRAP x22
TRAP x20
TRAP x21
ST R0 ROW
TRAP x20
TRAP x21
ST R0 NUM
LD R0 NEWLINE
TRAP x21
LD R6 ROW
BRnzp NEXT

NEXT ADD R5 R6 #-15
ADD R5 R5 #-15
ADD R5 R5 #-15
ADD R5 R5 #-15
ADD R5 R5 #-5
BRz TESTNA
ADD R5 R5 #-1
BRz TESTNB
ADD R5 R5 #-1
BRz TESTNC
BRnp ERROR

TESTNA LD R6 NUM
LD R5 ASCII
ADD R6 R5 R6
BRn ERROR
NOT R6 R6 
ADD R6 R6 #1
ADD R5 R1 #0
ADD R5 R6 R5
BRn ERROR
ADD R1 R5 #0
NOT R4 R4
BRnzp DISPLAY

TESTNB LD R6 NUM
LD R5 ASCII
ADD R6 R5 R6
BRn ERROR
NOT R6 R6 
ADD R6 R6 #1
ADD R5 R2 #0
ADD R5 R6 R5
BRn ERROR
ADD R2 R5 #0
NOT R4 R4
BRnzp DISPLAY

TESTNC LD R6 NUM
LD R5 ASCII
ADD R6 R5 R6
BRn ERROR
NOT R6 R6 
ADD R6 R6 #1
ADD R5 R3 #0
ADD R5 R6 R5
BRn ERROR
ADD R3 R5 #0
NOT R4 R4
BRnzp DISPLAY

ERROR ADD R4 R4 #0
BRp ERROR1
BRn ERROR2

ERROR2 LEA R0 INVALID
TRAP x22
LD R0 NEWLINE
TRAP x21
BRnzp P2

ERROR1 LEA R0 INVALID
TRAP x22
LD R0 NEWLINE
TRAP x21
BRnzp P1

;print "o"
PRINT LD R0 char
ADD R5 R5 #0
BRz NEW
LOOP TRAP x21
ADD R5 R5 #-1
BRp LOOP
NEW LD R0 NEWLINE
TRAP x21
RET

OVER ADD R4 R4 #0
BRn P2WIN
BRp P1WIN

P1WIN LEA R0 player1
TRAP x22
LEA R0 WIN
TRAP x22
BRnzp EXIT

P2WIN LEA R0 player2
TRAP x22
LEA R0 WIN
TRAP x22
BRnzp EXIT

EXIT TRAP x25

ASCII .FILL xFFD0
A .FILL x0003
B .FILL x0005
C .FILL x0008
ROWA .STRINGZ "ROW A:"
ROWB .STRINGZ "ROW B:"
ROWC .STRINGZ "ROW C:"
player1 .STRINGZ "Player 1"
player2 .STRINGZ "Player 2"
CHOOSE .STRINGZ ",choose a row and number of rocks:"
WIN .STRINGZ " Wins."
char .FILL x006F
NEWLINE .FILL x000A
ROW .BLKW #1
NUM .BLKW #1
INVALID .STRINGZ "Invalid move. Try again."

.END